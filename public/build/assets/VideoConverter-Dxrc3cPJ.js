var pe=Object.defineProperty;var le=i=>{throw TypeError(i)};var ge=(i,t,l)=>t in i?pe(i,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[t]=l;var k=(i,t,l)=>ge(i,typeof t!="symbol"?t+"":t,l),ae=(i,t,l)=>t.has(i)||le("Cannot "+l);var d=(i,t,l)=>(ae(i,t,"read from private field"),l?l.call(i):t.get(i)),D=(i,t,l)=>t.has(i)?le("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,l),P=(i,t,l,a)=>(ae(i,t,"write to private field"),a?a.call(i,l):t.set(i,l),l);import{r as M,l as we,f as xe,o as w,w as ye,b as e,a as y,g as L,t as x,n as Ee,i as W,F as G,m as H,u as j,p as z,j as oe,q as re}from"./app-DLR03OmS.js";import{_ as ke}from"./Layout.vue_vue_type_script_setup_true_lang-DoVmkXj_.js";var h;(function(i){i.LOAD="LOAD",i.EXEC="EXEC",i.FFPROBE="FFPROBE",i.WRITE_FILE="WRITE_FILE",i.READ_FILE="READ_FILE",i.DELETE_FILE="DELETE_FILE",i.RENAME="RENAME",i.CREATE_DIR="CREATE_DIR",i.LIST_DIR="LIST_DIR",i.DELETE_DIR="DELETE_DIR",i.ERROR="ERROR",i.DOWNLOAD="DOWNLOAD",i.PROGRESS="PROGRESS",i.LOG="LOG",i.MOUNT="MOUNT",i.UNMOUNT="UNMOUNT"})(h||(h={}));const Me=(()=>{let i=0;return()=>i++})(),Fe=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),Ie=new Error("called FFmpeg.terminate()");var R,S,V,A,T,X,F;class Re{constructor(){D(this,R,null);D(this,S,{});D(this,V,{});D(this,A,[]);D(this,T,[]);k(this,"loaded",!1);D(this,X,()=>{d(this,R)&&(d(this,R).onmessage=({data:{id:t,type:l,data:a}})=>{switch(l){case h.LOAD:this.loaded=!0,d(this,S)[t](a);break;case h.MOUNT:case h.UNMOUNT:case h.EXEC:case h.FFPROBE:case h.WRITE_FILE:case h.READ_FILE:case h.DELETE_FILE:case h.RENAME:case h.CREATE_DIR:case h.LIST_DIR:case h.DELETE_DIR:d(this,S)[t](a);break;case h.LOG:d(this,A).forEach(o=>o(a));break;case h.PROGRESS:d(this,T).forEach(o=>o(a));break;case h.ERROR:d(this,V)[t](a);break}delete d(this,S)[t],delete d(this,V)[t]})});D(this,F,({type:t,data:l},a=[],o)=>d(this,R)?new Promise((n,s)=>{const f=Me();d(this,R)&&d(this,R).postMessage({id:f,type:t,data:l},a),d(this,S)[f]=n,d(this,V)[f]=s,o==null||o.addEventListener("abort",()=>{s(new DOMException(`Message # ${f} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(Fe));k(this,"load",({classWorkerURL:t,...l}={},{signal:a}={})=>(d(this,R)||(P(this,R,t?new Worker(new URL(t,import.meta.url),{type:"module"}):new Worker(new URL("/build/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"})),d(this,X).call(this)),d(this,F).call(this,{type:h.LOAD,data:l},void 0,a)));k(this,"exec",(t,l=-1,{signal:a}={})=>d(this,F).call(this,{type:h.EXEC,data:{args:t,timeout:l}},void 0,a));k(this,"ffprobe",(t,l=-1,{signal:a}={})=>d(this,F).call(this,{type:h.FFPROBE,data:{args:t,timeout:l}},void 0,a));k(this,"terminate",()=>{const t=Object.keys(d(this,V));for(const l of t)d(this,V)[l](Ie),delete d(this,V)[l],delete d(this,S)[l];d(this,R)&&(d(this,R).terminate(),P(this,R,null),this.loaded=!1)});k(this,"writeFile",(t,l,{signal:a}={})=>{const o=[];return l instanceof Uint8Array&&o.push(l.buffer),d(this,F).call(this,{type:h.WRITE_FILE,data:{path:t,data:l}},o,a)});k(this,"mount",(t,l,a)=>{const o=[];return d(this,F).call(this,{type:h.MOUNT,data:{fsType:t,options:l,mountPoint:a}},o)});k(this,"unmount",t=>{const l=[];return d(this,F).call(this,{type:h.UNMOUNT,data:{mountPoint:t}},l)});k(this,"readFile",(t,l="binary",{signal:a}={})=>d(this,F).call(this,{type:h.READ_FILE,data:{path:t,encoding:l}},void 0,a));k(this,"deleteFile",(t,{signal:l}={})=>d(this,F).call(this,{type:h.DELETE_FILE,data:{path:t}},void 0,l));k(this,"rename",(t,l,{signal:a}={})=>d(this,F).call(this,{type:h.RENAME,data:{oldPath:t,newPath:l}},void 0,a));k(this,"createDir",(t,{signal:l}={})=>d(this,F).call(this,{type:h.CREATE_DIR,data:{path:t}},void 0,l));k(this,"listDir",(t,{signal:l}={})=>d(this,F).call(this,{type:h.LIST_DIR,data:{path:t}},void 0,l));k(this,"deleteDir",(t,{signal:l}={})=>d(this,F).call(this,{type:h.DELETE_DIR,data:{path:t}},void 0,l))}on(t,l){t==="log"?d(this,A).push(l):t==="progress"&&d(this,T).push(l)}off(t,l){t==="log"?P(this,A,d(this,A).filter(a=>a!==l)):t==="progress"&&P(this,T,d(this,T).filter(a=>a!==l))}}R=new WeakMap,S=new WeakMap,V=new WeakMap,A=new WeakMap,T=new WeakMap,X=new WeakMap,F=new WeakMap;var ie;(function(i){i.MEMFS="MEMFS",i.NODEFS="NODEFS",i.NODERAWFS="NODERAWFS",i.IDBFS="IDBFS",i.WORKERFS="WORKERFS",i.PROXYFS="PROXYFS"})(ie||(ie={}));const Oe=new Error("failed to get response body reader"),Ve=new Error("failed to complete download"),_e="Content-Length",De=i=>new Promise((t,l)=>{const a=new FileReader;a.onload=()=>{const{result:o}=a;o instanceof ArrayBuffer?t(new Uint8Array(o)):t(new Uint8Array)},a.onerror=o=>{var n,s;l(Error(`File could not be read! Code=${((s=(n=o==null?void 0:o.target)==null?void 0:n.error)==null?void 0:s.code)||-1}`))},a.readAsArrayBuffer(i)}),se=async i=>{let t;if(typeof i=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(i)?t=atob(i.split(",")[1]).split("").map(l=>l.charCodeAt(0)):t=await(await fetch(i)).arrayBuffer();else if(i instanceof URL)t=await(await fetch(i)).arrayBuffer();else if(i instanceof File||i instanceof Blob)t=await De(i);else return new Uint8Array;return new Uint8Array(t)},Le=async(i,t)=>{var o;const l=await fetch(i);let a;try{const n=parseInt(l.headers.get(_e)||"-1"),s=(o=l.body)==null?void 0:o.getReader();if(!s)throw Oe;const f=[];let p=0;for(;;){const{done:c,value:b}=await s.read(),I=b?b.length:0;if(c){if(n!=-1&&n!==p)throw Ve;t&&t({url:i,total:n,received:p,delta:I,done:c});break}f.push(b),p+=I,t&&t({url:i,total:n,received:p,delta:I,done:c})}const v=new Uint8Array(p);let g=0;for(const c of f)v.set(c,g),g+=c.length;a=v.buffer}catch(n){console.log("failed to send download progress event: ",n),a=await l.arrayBuffer()}return a},Q=async(i,t,l=!1,a)=>{const o=l?await Le(i,a):await(await fetch(i)).arrayBuffer(),n=new Blob([o],{type:t});return URL.createObjectURL(n)},Y="https://cdn.jsdelivr.net/npm/@ffmpeg/core-mt@0.12.10/dist/esm",ne=[{value:"mp4",label:"MP4 (H.264/H.265)"},{value:"avi",label:"AVI (Xvid)"},{value:"mov",label:"MOV (QuickTime)"},{value:"mkv",label:"MKV (Matroska)"},{value:"wmv",label:"WMV (Windows Media)"},{value:"flv",label:"FLV (Flash Video)"},{value:"webm",label:"WebM (VP8/VP9/AV1)"},{value:"m4v",label:"M4V (iTunes)"},{value:"3gp",label:"3GP (Mobile)"},{value:"ogv",label:"OGV (Ogg Video)"},{value:"ts",label:"TS (Transport Stream)"},{value:"mts",label:"MTS (AVCHD)"},{value:"asf",label:"ASF (Advanced Systems)"},{value:"vob",label:"VOB (DVD Video)"},{value:"mpg",label:"MPG (MPEG-1/2)"},{value:"mpeg",label:"MPEG (MPEG-1/2)"},{value:"divx",label:"DIVX (DivX)"},{value:"xvid",label:"XVID (Xvid)"},{value:"swf",label:"SWF (Flash)"},{value:"f4v",label:"F4V (Flash Video)"},{value:"m2ts",label:"M2TS (Blu-ray)"},{value:"mxf",label:"MXF (Material Exchange)"},{value:"gif",label:"GIF (Animated)"},{value:"apng",label:"APNG (Animated PNG)"},{value:"webp",label:"WebP (Web Picture)"},{value:"avif",label:"AVIF (AV1 Image)"},{value:"heic",label:"HEIC (HEIF)"},{value:"heif",label:"HEIF (High Efficiency)"}],de=[{value:"high",label:"高质量"},{value:"medium",label:"中等质量"},{value:"low",label:"低质量"}],ue=[{value:"original",label:"保持原分辨率"},{value:"4k",label:"4K (3840x2160)"},{value:"1080p",label:"1080p (1920x1080)"},{value:"720p",label:"720p (1280x720)"},{value:"480p",label:"480p (854x480)"}],ce=[{value:"original",label:"保持原帧率"},{value:"60",label:"60 FPS"},{value:"30",label:"30 FPS"},{value:"25",label:"25 FPS"},{value:"24",label:"24 FPS"}],Se={"4k":"3840:2160","1080p":"1920:1080","720p":"1280:720","480p":"854:480"},Ae={high:18,medium:23,low:28},Te=["video/mp4","video/avi","video/quicktime","video/x-matroska","video/x-ms-wmv","video/x-flv","video/webm","video/x-msvideo","video/3gpp","video/ogg","video/mpeg","video/x-m4v"],Ce=["mp4","avi","mov","mkv","wmv","flv","webm","m4v","3gp","ogv","ts","mts","rm","rmvb","asf","vob","mpg","mpeg","divx","xvid","swf","f4v","m2ts","mxf","gif","apng","webp","avif","heic","heif"],q=100*1024*1024;class Be{constructor(){this.ffmpeg=new Re,this.isLoaded=!1,this.isLoading=!1}async init(t){try{return this.isLoading=!0,t&&t("正在加载资源..."),await this.ffmpeg.load({coreURL:await Q(`${Y}/ffmpeg-core.js`,"text/javascript"),wasmURL:await Q(`${Y}/ffmpeg-core.wasm`,"application/wasm"),workerURL:await Q(`${Y}/ffmpeg-core.worker.js`,"text/javascript")}),this.isLoaded=!0,this.isLoading=!1,t&&t("资源加载完成！"),!0}catch(l){throw console.error("FFmpeg加载失败:",l),this.isLoading=!1,new Error("资源加载失败，请刷新页面重试")}}getSupportedConfigs(){return{outputFormats:ne,videoQualityOptions:de,resolutionOptions:ue,framerateOptions:ce,supportedFileTypes:Te,supportedExtensions:Ce,maxFileSize:q}}async convert(t,l,a){if(!this.isLoaded)throw new Error("FFmpeg尚未初始化，请先调用init()方法");let o,n,s;if(typeof t=="string")try{a&&a("正在获取在线文件...",0);const p=await fetch(t);if(!p.ok)throw new Error(`无法获取文件: ${p.statusText}`);const v=await p.blob();o=new File([v],"input_video",{type:v.type}),n=this.getFileExtensionFromUrl(t)||"mp4",s=`input_video.${n}`,a&&a("在线文件获取完成",5)}catch(p){throw new Error(`获取在线文件失败: ${p instanceof Error?p.message:"未知错误"}`)}else o=t,n=this.getFileExtension(t.name),s=t.name;if(o.size>q)throw new Error("文件过大，请选择小于100MB的文件");const f=l.outputFormat||"mp4";console.log("开始转换:",s,"→",f);try{a&&a("正在写入输入文件...",5),await this.ffmpeg.writeFile(`input.${n}`,await se(o)),a&&a("输入文件写入完成，开始转码...",10),await this.performSeparateTranscode(n,f,l,a),a&&a("正在读取输出文件...",90);const p=await this.ffmpeg.readFile(`output.${f}`);if(!p||p.length===0)throw new Error("输出文件为空或无效");const v=p,g=v.buffer.slice(v.byteOffset,v.byteOffset+v.byteLength),c=new Blob([g],{type:`video/${f}`});a&&a("转换完成！",100),await this.cleanupFiles(n,f);const I=`${s.substring(0,s.lastIndexOf("."))}.${f}`;return{blob:c,filename:I,size:v.length}}catch(p){throw console.error("转换失败:",p),await this.cleanupFiles(n,f),p}}getFileExtension(t){var l;return((l=t.split(".").pop())==null?void 0:l.toLowerCase())||"mp4"}getFileExtensionFromUrl(t){try{const a=new URL(t).pathname;return this.getFileExtension(a)}catch{return"mp4"}}async performSeparateTranscode(t,l,a,o){let n=0,s=0,f=0;const p=new Promise((v,g)=>{setTimeout(()=>{g(new Error("转换超时，请尝试更小的文件或更低的设置"))},1e3*60)});try{if(this.ffmpeg.off("log"),o){const _=({message:C})=>{if(C.includes("frame=")){const B=C.match(/frame=\s*(\d+)/);if(B){const U=parseInt(B[1]),K=Math.min(10+U/1e3*30,40);o(`正在转码视频... (帧: ${U})`,parseFloat(K.toFixed(2)))}}};this.ffmpeg.on("log",_)}o&&o("开始转码视频...",10);const v=this.buildVideoCommand(t,l,a),g=Date.now();await Promise.race([this.ffmpeg.exec(v),p]),n=Date.now()-g,o&&o("视频转码完成，开始处理音频...",40);const c=this.buildAudioCommand(t,l),b=Date.now();await Promise.race([this.ffmpeg.exec(c),p]),s=Date.now()-b,o&&o("音频处理完成，开始合并...",70);const I=this.buildMergeCommand(l),O=Date.now();await Promise.race([this.ffmpeg.exec(I),p]),f=Date.now()-O,o&&o("合并完成",90),console.log("转码完成，总耗时:",n+s+f,"ms"),o&&this.ffmpeg.off("log")}catch(v){throw console.error("转码失败:",v),o&&this.ffmpeg.off("log"),v}}buildVideoCommand(t,l,a){const o=["-i",`input.${t}`];if(a.resolution&&a.resolution!=="original"){const s=Se[a.resolution];s&&o.push("-vf",`scale=${s}`)}a.framerate&&a.framerate!=="original"&&o.push("-r",a.framerate);const n=Ae[a.videoQuality||"medium"]||23;return o.push("-c:v","libx264","-preset","ultrafast","-crf",n.toString()),o.push("-an"),o.push("-y",`video_only.${l}`),o}buildAudioCommand(t,l){const a=["-i",`input.${t}`];return a.push("-vn"),l==="avi"?(a.push("-c:a","mp3","-b:a","128k","-ar","44100"),a.push("-y","audio.mp3")):(a.push("-c:a","aac","-b:a","128k","-ar","48000"),a.push("-y","audio.aac")),a}buildMergeCommand(t){const l=t==="avi"?"audio.mp3":"audio.aac";return["-i",`video_only.${t}`,"-i",l,"-c:v","copy","-c:a","copy","-shortest","-y",`output.${t}`]}async cleanupFiles(t,l){try{let a=[`input.${t}`];if(l){const o=l==="avi"?"audio.mp3":"audio.aac";a=[`input.${t}`,`video_only.${l}`,o,`output.${l}`]}for(const o of a)try{await this.ffmpeg.deleteFile(o)}catch(n){console.warn("删除临时文件失败:",n)}}catch(a){console.warn("清理临时文件失败:",a)}}isReady(){return this.isLoaded&&!this.isLoading}getLoadingState(){return{isLoaded:this.isLoaded,isLoading:this.isLoading}}async getFileInfo(t,l){if(!this.isLoaded)throw new Error("FFmpeg尚未初始化，请先调用init()方法");let a,o,n;if(typeof t=="string")try{l&&l("正在获取在线文件信息...");const s=await fetch(t);if(!s.ok)throw new Error(`无法获取文件: ${s.statusText}`);const f=await s.blob();a=new File([f],"input_video",{type:f.type}),o=this.getFileExtensionFromUrl(t)||"mp4",n=`input_video.${o}`,l&&l("在线文件获取完成")}catch(s){throw new Error(`获取在线文件失败: ${s instanceof Error?s.message:"未知错误"}`)}else a=t,o=this.getFileExtension(t.name),n=t.name;if(a.size>q)throw new Error("文件过大，请选择小于100MB的文件");try{l&&l("正在分析文件信息..."),await this.ffmpeg.writeFile(`input.${o}`,await se(a));let s={duration:null,resolution:null,fps:null,videoCodec:null,audioCodec:null,bitrate:null};const f=({message:v})=>{if(v.includes("Duration:")){const g=v.match(/Duration: (\d{2}):(\d{2}):(\d{2}\.\d{2})/);if(g){const c=parseInt(g[1]),b=parseInt(g[2]),I=parseFloat(g[3]);s.duration=c*3600+b*60+I}}if(v.includes("Video:")){const g=v.match(/(\d{3,4})x(\d{3,4})/),c=v.match(/(\d+) fps/),b=v.match(/Video: (\w+)/),I=v.match(/(\d+) kb\/s/);if(g){const O=parseInt(g[1]),_=parseInt(g[2]);O>=100&&_>=100&&(s.resolution=`${O}x${_}`)}c&&(s.fps=parseInt(c[1])),b&&(s.videoCodec=b[1]),I&&(s.bitrate=`${I[1]} kb/s`)}if(v.includes("Audio:")){const g=v.match(/Audio: (\w+)/);g&&(s.audioCodec=g[1])}};this.ffmpeg.on("log",f);try{await this.ffmpeg.exec(["-i",`input.${o}`])}finally{this.ffmpeg.off("log",f)}await this.cleanupFiles(o,null);const p={filename:n,size:a.size,sizeFormatted:this.formatFileSize(a.size),duration:s.duration,durationFormatted:s.duration?this.formatDuration(s.duration):null,format:o,bitrate:s.bitrate?s.bitrate.replace(" kb/s",""):null,bitrateFormatted:s.bitrate,video:s.resolution?{codec:s.videoCodec||"未知",width:s.resolution?parseInt(s.resolution.split("x")[0]):null,height:s.resolution?parseInt(s.resolution.split("x")[1]):null,resolution:s.resolution,framerate:s.fps,bitrate:s.bitrate?s.bitrate.replace(" kb/s",""):null,bitrateFormatted:s.bitrate}:null,audio:s.audioCodec?{codec:s.audioCodec,channels:null,sampleRate:null,bitrate:null,bitrateFormatted:null}:null,streams:(s.resolution?1:0)+(s.audioCodec?1:0)};return l&&l("文件信息分析完成"),p}catch(s){throw console.error("获取文件信息失败:",s),await this.cleanupFiles(o,null),new Error(`获取文件信息失败: ${s instanceof Error?s.message:"未知错误"}`)}}formatFileSize(t){if(t===0)return"0 B";const l=1024,a=["B","KB","MB","GB"],o=Math.floor(Math.log(t)/Math.log(l));return parseFloat((t/Math.pow(l,o)).toFixed(2))+" "+a[o]}formatDuration(t){const l=Math.floor(t/3600),a=Math.floor(t%3600/60),o=Math.floor(t%60);return l>0?`${l}:${a.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`:`${a}:${o.toString().padStart(2,"0")}`}formatBitrate(t){if(t===0)return"0 bps";const l=1e3,a=["bps","Kbps","Mbps","Gbps"],o=Math.floor(Math.log(t)/Math.log(l));return parseFloat((t/Math.pow(l,o)).toFixed(2))+" "+a[o]}parseFrameRate(t){if(!t)return null;const l=t.split("/");if(l.length===2){const a=parseInt(l[0]),o=parseInt(l[1]);return o!==0?(a/o).toFixed(2):null}return parseFloat(t).toFixed(2)}}const Z=new Be,$e={class:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8"},Pe={class:"grid grid-cols-1 lg:grid-cols-10 gap-8"},Ue={class:"lg:col-span-6 order-1 lg:order-2"},Ne={class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8"},We={class:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md"},Ge={class:"flex items-center"},He={class:"text-blue-800 dark:text-blue-200"},je={class:"mb-8"},ze={class:"mt-4"},Xe={key:0,class:"mt-2 text-sm text-blue-600 dark:text-blue-400"},Ke={key:1,class:"mt-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-md"},Qe={class:"space-y-2 text-xs text-gray-600 dark:text-gray-400"},Ye={class:"grid grid-cols-2 gap-2"},qe={key:0,class:"border-t pt-2"},Ze={class:"grid grid-cols-2 gap-2"},Je={key:1,class:"border-t pt-2"},et={class:"grid grid-cols-2 gap-2"},tt={class:"mb-8"},lt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},at=["value"],ot=["value"],rt=["value"],it=["value"],st={class:"text-center"},nt=["disabled"],dt={key:0,class:"inline-block h-5 w-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ut={key:1,class:"inline-block h-5 w-5 mr-2 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ct={key:0,class:"mt-8"},mt={class:"flex items-center justify-between mb-2"},ft={class:"text-sm font-medium text-blue-600 dark:text-blue-400"},vt={class:"bg-gray-200 dark:bg-gray-700 rounded-full h-2"},bt={key:1,class:"mt-8"},ht={class:"flex items-center justify-between mb-2"},pt={class:"text-sm font-medium text-blue-600 dark:text-blue-400"},gt={class:"bg-gray-200 dark:bg-gray-700 rounded-full h-2"},wt={key:2,class:"mt-8 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md"},xt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},yt={class:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl"},Et={class:"mt-2"},kt={class:"text-sm text-gray-500 dark:text-gray-400 whitespace-pre-line"},Mt={class:"mt-4 flex justify-end"},Ot={__name:"VideoConverter",setup(i){const t=M(!1),l=M(!1),a=M(!1),o=M(0),n=M(null),s=M(null),f=M(""),p=M("请选择视频文件开始转换"),v=M(!1),g=M(""),c=M(null),b=u=>{p.value=u,console.log(`[VideoConverter] ${u}`)},I=u=>{g.value=u,v.value=!0},O=M("mp4"),_=M("high"),C=M("original"),B=M("original");we(async()=>{try{a.value=!0,b("正在加载资源...");const u=setInterval(()=>{o.value<80&&(o.value+=5,b(`正在加载资源... ${o.value}%`))},200);await Z.init(r=>{b(r)}),clearInterval(u),o.value=100,b("资源加载完成！"),t.value=!0,a.value=!1,await new Promise(r=>setTimeout(r,1e3)),b("请选择视频文件开始转换"),o.value=0}catch(u){console.error("FFmpeg加载失败:",u),b("资源加载失败，请刷新页面重试"),a.value=!1}});const U=async u=>{const r=u.target;r.files&&r.files[0]&&(n.value=r.files[0],s.value=null,f.value="",o.value=0,c.value=null,b(`已选择文件: ${n.value.name}`),await J())},K=async u=>{var r;console.log(u),u.preventDefault(),(r=u.dataTransfer)!=null&&r.files&&u.dataTransfer.files[0]&&(n.value=u.dataTransfer.files[0],s.value=null,f.value="",o.value=0,c.value=null,b(`已选择文件: ${n.value.name}`),await J())},me=u=>{u.preventDefault()},J=async()=>{var u,r,m,N,$,ee,te;if(n.value){if(!t.value){b("资源尚未加载完成，无法读取视频信息");return}try{b("正在读取视频信息...");const E=await Z.getFileInfo(n.value,he=>{b(he)});c.value={duration:E.duration||0,fps:((u=E.video)==null?void 0:u.framerate)||30,totalFrames:E.duration?Math.round(E.duration*(((r=E.video)==null?void 0:r.framerate)||30)):0,resolution:((m=E.video)==null?void 0:m.resolution)||"未知",bitrate:E.bitrateFormatted||"未知",format:E.format,size:E.sizeFormatted,videoCodec:((N=E.video)==null?void 0:N.codec)||"未知",audioCodec:(($=E.audio)==null?void 0:$.codec)||"未知",streams:E.streams},b(`视频信息读取成功: ${((ee=E.video)==null?void 0:ee.resolution)||"未知分辨率"}, ${E.durationFormatted||"未知时长"}, ${((te=E.video)==null?void 0:te.framerate)||"未知"}fps`)}catch(E){console.error("读取视频信息失败:",E),b("读取视频信息失败，但可以继续转换"),c.value=null}}},fe=async()=>{if(!n.value){alert("请先选择视频文件");return}const u=100*1024*1024;if(n.value.size>u){alert("文件过大，请选择小于100MB的文件");return}console.log("开始转换:",n.value.name,"→",O.value),l.value=!0,o.value=0,b("正在加载资源...");try{if(!t.value){b("资源尚未加载完成，请稍候...");return}b("开始转换..."),o.value=0;const r={outputFormat:O.value,videoQuality:_.value,resolution:C.value,framerate:B.value},m=await Z.convert(n.value,r,(N,$)=>{b(N),$!==void 0&&(o.value=$)});s.value=m.blob,f.value=URL.createObjectURL(m.blob),o.value=100,b("转换完成！")}catch(r){console.error("转换失败:",r),b("转换失败，请检查文件格式或重试"),I(r instanceof Error?r.message:"转换失败，请检查文件格式或重试")}finally{l.value=!1,a.value=!1}},ve=async()=>{try{const u=await fetch("/api/tools/record-usage-public",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({tool_name:"视频转码"})});u.ok?console.log("工具使用记录已保存"):console.warn("工具使用记录失败:",u.status)}catch(u){console.warn("记录工具使用时出错:",u)}},be=async()=>{if(s.value&&f.value&&n.value){const u=document.createElement("a");u.href=f.value;const r=n.value.name,m=r.substring(0,r.lastIndexOf("."));u.download=`${m}.${O.value}`,document.body.appendChild(u),u.click(),document.body.removeChild(u),await ve()}};return(u,r)=>(w(),xe(ke,{title:"视频格式转换工具 - 在线MP4、AVI、MOV、MKV转换器 | 小左子的工具箱"},{default:ye(()=>[e("div",$e,[e("div",Pe,[r[27]||(r[27]=e("div",{class:"lg:col-span-4 order-2 lg:order-1"},[e("div",{class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 lg:sticky lg:top-8"},[e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-4"}," 在线视频格式转换工具 "),e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-4"}," 专业的在线视频格式转换器，支持MP4、AVI、MOV、MKV等多种格式转换。无需下载软件，免费在线使用，快速高效。 "),e("div",{class:"grid grid-cols-2 gap-4"},[e("div",null,[e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"}," 支持的输入格式 "),e("ul",{class:"text-gray-600 dark:text-gray-400 space-y-1 text-sm"},[e("li",null,"• MP4 (H.264, H.265)"),e("li",null,"• AVI (Xvid, DivX)"),e("li",null,"• MOV (QuickTime)"),e("li",null,"• MKV (Matroska)"),e("li",null,"• WMV (Windows Media)"),e("li",null,"• FLV (Flash Video)"),e("li",null,"• WebM (VP8, VP9, AV1)"),e("li",null,"• M4V (iTunes)"),e("li",null,"• 3GP (Mobile)"),e("li",null,"• OGV (Ogg Video)"),e("li",null,"• TS/MTS (Transport Stream)"),e("li",null,"• RM/RMVB (RealMedia)"),e("li",null,"• ASF (Advanced Systems)"),e("li",null,"• VOB (DVD Video)"),e("li",null,"• MPG/MPEG (MPEG-1/2)"),e("li",null,"• SWF/F4V (Flash)"),e("li",null,"• M2TS (Blu-ray)"),e("li",null,"• MXF (Material Exchange)"),e("li",null,"• GIF/APNG (Animated)"),e("li",null,"• WebP/AVIF (Web Images)"),e("li",null,"• HEIC/HEIF (High Efficiency)"),e("li",null,"• 以及更多图片格式...")])]),e("div",null,[e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"}," 支持的输出格式 "),e("ul",{class:"text-gray-600 dark:text-gray-400 space-y-1 text-sm"},[e("li",null,"• MP4 (H.264, H.265)"),e("li",null,"• AVI (Xvid)"),e("li",null,"• MOV (QuickTime)"),e("li",null,"• MKV (Matroska)"),e("li",null,"• WMV (Windows Media)"),e("li",null,"• FLV (Flash Video)"),e("li",null,"• WebM (VP8, VP9, AV1)"),e("li",null,"• M4V (iTunes)"),e("li",null,"• 3GP (Mobile)"),e("li",null,"• OGV (Ogg Video)"),e("li",null,"• TS/MTS (Transport Stream)"),e("li",null,"• ASF (Advanced Systems)"),e("li",null,"• VOB (DVD Video)"),e("li",null,"• MPG/MPEG (MPEG-1/2)"),e("li",null,"• SWF/F4V (Flash)"),e("li",null,"• M2TS (Blu-ray)"),e("li",null,"• MXF (Material Exchange)"),e("li",null,"• GIF/APNG (Animated)"),e("li",null,"• WebP/AVIF (Web Images)"),e("li",null,"• HEIC/HEIF (High Efficiency)"),e("li",null,"• 以及更多图片格式...")])])]),e("div",{class:"mt-6 space-y-4"},[e("div",{class:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md"},[e("div",{class:"flex items-start"},[e("svg",{class:"h-5 w-5 text-green-400 mr-2 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("div",null,[e("h4",{class:"text-sm font-medium text-green-800 dark:text-green-200"}," 智能分离转码 "),e("p",{class:"text-sm text-green-700 dark:text-green-300 mt-1"}," 系统采用分离式转码技术，分别处理视频和音频，有效避免转换卡住问题，提供更稳定的转换体验。 "),e("div",{class:"mt-2 text-xs text-green-600 dark:text-green-400"},[e("div",null,"• 自动检测音频流并选择最佳处理方式"),e("div",null,"• 视频和音频独立处理，避免相互影响"),e("div",null,"• 支持多种音频编码器，兼容性更好")])])])]),e("div",{class:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md"},[e("div",{class:"flex items-start"},[e("svg",{class:"h-5 w-5 text-blue-400 mr-2 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})]),e("div",null,[e("h4",{class:"text-sm font-medium text-blue-800 dark:text-blue-200"}," 强大的格式转换支持 "),e("p",{class:"text-sm text-blue-700 dark:text-blue-300 mt-1"}," 基于融茂软件核心，支持超过50种视频格式和编码器，包括最新的AV1、H.265等先进编码技术。 "),e("div",{class:"mt-2 text-xs text-blue-600 dark:text-blue-400"},[e("div",null,"• 支持H.264、H.265、VP8、VP9、AV1等现代编码"),e("div",null,"• 兼容MPEG-1/2、Xvid、DivX等传统格式"),e("div",null,"• 支持GIF、WebP、AVIF等图片和动画格式"),e("div",null,"• 专业级MXF、M2TS等广播级格式支持")])])])])])])],-1)),e("div",Ue,[e("div",Ne,[e("div",We,[e("div",Ge,[r[5]||(r[5]=e("svg",{class:"h-5 w-5 text-blue-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",He,x(p.value),1)])]),e("div",je,[r[13]||(r[13]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-4"}," 选择视频文件 ",-1)),e("div",{onDrop:K,onDragover:me,class:Ee(["border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-blue-400 dark:hover:border-blue-400 transition-colors",{"border-blue-400 bg-blue-50 dark:bg-blue-900/20":n.value}])},[r[12]||(r[12]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48"},[e("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),e("div",ze,[r[10]||(r[10]=e("label",{for:"file-upload",class:"cursor-pointer bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors"}," 选择文件 ",-1)),e("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",accept:"video/*",onChange:U},null,32),r[11]||(r[11]=e("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"}," 支持 MP4, AVI, MOV, MKV, WMV, WebM, M4V, 3GP, OGV, TS, MTS, RM, RMVB, ASF, VOB, MPG, MPEG, DIVX, XVID, SWF, F4V, M2TS, MXF, GIF, APNG, WebP, AVIF, HEIC, HEIF 等格式 ",-1)),n.value?(w(),y("p",Xe," 已选择: "+x(n.value.name),1)):L("",!0),c.value?(w(),y("div",Ke,[r[9]||(r[9]=e("h4",{class:"text-sm font-medium text-gray-900 dark:text-white mb-2"}," 视频信息 ",-1)),e("div",Qe,[e("div",Ye,[e("div",null,"文件大小: "+x(c.value.size),1),e("div",null,"格式: "+x(c.value.format),1),e("div",null," 时长: "+x(c.value.duration>0?c.value.duration.toFixed(2)+"秒":"未知"),1),e("div",null,"流数量: "+x(c.value.streams),1)]),c.value.resolution!=="未知"?(w(),y("div",qe,[r[6]||(r[6]=e("div",{class:"font-medium text-gray-700 dark:text-gray-300 mb-1"}," 视频信息 ",-1)),e("div",Ze,[e("div",null,"分辨率: "+x(c.value.resolution),1),e("div",null,"帧率: "+x(c.value.fps)+"fps",1),e("div",null,"编码: "+x(c.value.videoCodec),1),e("div",null,"比特率: "+x(c.value.bitrate),1)])])):L("",!0),c.value.audioCodec!=="未知"?(w(),y("div",Je,[r[8]||(r[8]=e("div",{class:"font-medium text-gray-700 dark:text-gray-300 mb-1"}," 音频信息 ",-1)),e("div",et,[e("div",null,"编码: "+x(c.value.audioCodec),1),r[7]||(r[7]=e("div",null,"声道: 未知",-1))])])):L("",!0)])])):L("",!0)])],34)]),e("div",tt,[r[18]||(r[18]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-4"}," 转换选项 ",-1)),e("div",lt,[e("div",null,[r[14]||(r[14]=e("label",{for:"output-format",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 输出格式 ",-1)),W(e("select",{id:"output-format","onUpdate:modelValue":r[0]||(r[0]=m=>O.value=m),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},[(w(!0),y(G,null,H(j(ne),m=>(w(),y("option",{key:m.value,value:m.value},x(m.label),9,at))),128))],512),[[z,O.value]])]),e("div",null,[r[15]||(r[15]=e("label",{for:"video-quality",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 视频质量 ",-1)),W(e("select",{id:"video-quality","onUpdate:modelValue":r[1]||(r[1]=m=>_.value=m),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},[(w(!0),y(G,null,H(j(de),m=>(w(),y("option",{key:m.value,value:m.value},x(m.label),9,ot))),128))],512),[[z,_.value]])]),e("div",null,[r[16]||(r[16]=e("label",{for:"resolution",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 分辨率 ",-1)),W(e("select",{id:"resolution","onUpdate:modelValue":r[2]||(r[2]=m=>C.value=m),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},[(w(!0),y(G,null,H(j(ue),m=>(w(),y("option",{key:m.value,value:m.value},x(m.label),9,rt))),128))],512),[[z,C.value]])]),e("div",null,[r[17]||(r[17]=e("label",{for:"framerate",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 帧率 ",-1)),W(e("select",{id:"framerate","onUpdate:modelValue":r[3]||(r[3]=m=>B.value=m),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},[(w(!0),y(G,null,H(j(ce),m=>(w(),y("option",{key:m.value,value:m.value},x(m.label),9,it))),128))],512),[[z,B.value]])])])]),e("div",st,[e("button",{onClick:fe,disabled:!n.value||!c.value||l.value||!t.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium py-3 px-8 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[l.value?(w(),y("svg",ut,r[20]||(r[20]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)]))):(w(),y("svg",dt,r[19]||(r[19]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"},null,-1)]))),oe(" "+x(l.value?"转换中...":"开始转换"),1)],8,nt)]),a.value?(w(),y("div",ct,[r[22]||(r[22]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"}," 资源加载进度 ",-1)),e("div",mt,[r[21]||(r[21]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"正在加载核心文件，请稍候...",-1)),e("span",ft,x(Math.round(o.value))+"%",1)]),e("div",vt,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:re({width:o.value+"%"})},null,4)])])):L("",!0),l.value&&!a.value?(w(),y("div",bt,[r[24]||(r[24]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"}," 转换进度 ",-1)),e("div",ht,[r[23]||(r[23]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"正在转换中，请稍候...",-1)),e("span",pt,x(Math.round(o.value))+"%",1)]),e("div",gt,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:re({width:o.value+"%"})},null,4)])])):L("",!0),s.value&&f.value?(w(),y("div",wt,[e("div",{class:"flex items-center justify-between"},[r[26]||(r[26]=e("div",{class:"flex items-center"},[e("svg",{class:"h-5 w-5 text-green-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",{class:"text-green-800 dark:text-green-200"},"转换完成！")],-1)),e("button",{onClick:be,class:"bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition-colors"},r[25]||(r[25]=[e("svg",{class:"inline-block h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),oe(" 下载文件 ",-1)]))])])):L("",!0)])])])]),v.value?(w(),y("div",xt,[e("div",yt,[r[28]||(r[28]=e("div",{class:"flex items-center mb-4"},[e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])]),e("div",{class:"ml-3"},[e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"转换失败")])],-1)),e("div",Et,[e("p",kt,x(g.value),1)]),e("div",Mt,[e("button",{onClick:r[4]||(r[4]=m=>v.value=!1),class:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors"}," 确定 ")])])])):L("",!0)]),_:1}))}};export{Ot as default};
