var he=Object.defineProperty;var ee=s=>{throw TypeError(s)};var xe=(s,t,i)=>t in s?he(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i;var k=(s,t,i)=>xe(s,typeof t!="symbol"?t+"":t,i),ae=(s,t,i)=>t.has(s)||ee("Cannot "+i);var c=(s,t,i)=>(ae(s,t,"read from private field"),i?i.call(s):t.get(s)),A=(s,t,i)=>t.has(s)?ee("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,i),_=(s,t,i,d)=>(ae(s,t,"write to private field"),d?d.call(s,i):t.set(s,i),i);import{d as we,r as V,l as ye,f as Ee,o as O,w as ke,b as e,a as T,g as B,t as I,n as Me,i as $,m as U,j as le,p as oe}from"./app-BAaUhpCS.js";import{_ as Ve}from"./Layout.vue_vue_type_script_setup_true_lang-BtoECiGn.js";var p;(function(s){s.LOAD="LOAD",s.EXEC="EXEC",s.FFPROBE="FFPROBE",s.WRITE_FILE="WRITE_FILE",s.READ_FILE="READ_FILE",s.DELETE_FILE="DELETE_FILE",s.RENAME="RENAME",s.CREATE_DIR="CREATE_DIR",s.LIST_DIR="LIST_DIR",s.DELETE_DIR="DELETE_DIR",s.ERROR="ERROR",s.DOWNLOAD="DOWNLOAD",s.PROGRESS="PROGRESS",s.LOG="LOG",s.MOUNT="MOUNT",s.UNMOUNT="UNMOUNT"})(p||(p={}));const Ce=(()=>{let s=0;return()=>s++})(),Ie=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),Pe=new Error("called FFmpeg.terminate()");var C,S,F,L,G,j,M;class De{constructor(){A(this,C,null);A(this,S,{});A(this,F,{});A(this,L,[]);A(this,G,[]);k(this,"loaded",!1);A(this,j,()=>{c(this,C)&&(c(this,C).onmessage=({data:{id:t,type:i,data:d}})=>{switch(i){case p.LOAD:this.loaded=!0,c(this,S)[t](d);break;case p.MOUNT:case p.UNMOUNT:case p.EXEC:case p.FFPROBE:case p.WRITE_FILE:case p.READ_FILE:case p.DELETE_FILE:case p.RENAME:case p.CREATE_DIR:case p.LIST_DIR:case p.DELETE_DIR:c(this,S)[t](d);break;case p.LOG:c(this,L).forEach(n=>n(d));break;case p.PROGRESS:c(this,G).forEach(n=>n(d));break;case p.ERROR:c(this,F)[t](d);break}delete c(this,S)[t],delete c(this,F)[t]})});A(this,M,({type:t,data:i},d=[],n)=>c(this,C)?new Promise((m,x)=>{const E=Ce();c(this,C)&&c(this,C).postMessage({id:E,type:t,data:i},d),c(this,S)[E]=m,c(this,F)[E]=x,n==null||n.addEventListener("abort",()=>{x(new DOMException(`Message # ${E} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(Ie));k(this,"load",({classWorkerURL:t,...i}={},{signal:d}={})=>(c(this,C)||(_(this,C,t?new Worker(new URL(t,import.meta.url),{type:"module"}):new Worker(new URL("/build/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"})),c(this,j).call(this)),c(this,M).call(this,{type:p.LOAD,data:i},void 0,d)));k(this,"exec",(t,i=-1,{signal:d}={})=>c(this,M).call(this,{type:p.EXEC,data:{args:t,timeout:i}},void 0,d));k(this,"ffprobe",(t,i=-1,{signal:d}={})=>c(this,M).call(this,{type:p.FFPROBE,data:{args:t,timeout:i}},void 0,d));k(this,"terminate",()=>{const t=Object.keys(c(this,F));for(const i of t)c(this,F)[i](Pe),delete c(this,F)[i],delete c(this,S)[i];c(this,C)&&(c(this,C).terminate(),_(this,C,null),this.loaded=!1)});k(this,"writeFile",(t,i,{signal:d}={})=>{const n=[];return i instanceof Uint8Array&&n.push(i.buffer),c(this,M).call(this,{type:p.WRITE_FILE,data:{path:t,data:i}},n,d)});k(this,"mount",(t,i,d)=>{const n=[];return c(this,M).call(this,{type:p.MOUNT,data:{fsType:t,options:i,mountPoint:d}},n)});k(this,"unmount",t=>{const i=[];return c(this,M).call(this,{type:p.UNMOUNT,data:{mountPoint:t}},i)});k(this,"readFile",(t,i="binary",{signal:d}={})=>c(this,M).call(this,{type:p.READ_FILE,data:{path:t,encoding:i}},void 0,d));k(this,"deleteFile",(t,{signal:i}={})=>c(this,M).call(this,{type:p.DELETE_FILE,data:{path:t}},void 0,i));k(this,"rename",(t,i,{signal:d}={})=>c(this,M).call(this,{type:p.RENAME,data:{oldPath:t,newPath:i}},void 0,d));k(this,"createDir",(t,{signal:i}={})=>c(this,M).call(this,{type:p.CREATE_DIR,data:{path:t}},void 0,i));k(this,"listDir",(t,{signal:i}={})=>c(this,M).call(this,{type:p.LIST_DIR,data:{path:t}},void 0,i));k(this,"deleteDir",(t,{signal:i}={})=>c(this,M).call(this,{type:p.DELETE_DIR,data:{path:t}},void 0,i))}on(t,i){t==="log"?c(this,L).push(i):t==="progress"&&c(this,G).push(i)}off(t,i){t==="log"?_(this,L,c(this,L).filter(d=>d!==i)):t==="progress"&&_(this,G,c(this,G).filter(d=>d!==i))}}C=new WeakMap,S=new WeakMap,F=new WeakMap,L=new WeakMap,G=new WeakMap,j=new WeakMap,M=new WeakMap;var te;(function(s){s.MEMFS="MEMFS",s.NODEFS="NODEFS",s.NODERAWFS="NODERAWFS",s.IDBFS="IDBFS",s.WORKERFS="WORKERFS",s.PROXYFS="PROXYFS"})(te||(te={}));const Fe=new Error("failed to get response body reader"),Re=new Error("failed to complete download"),Ae="Content-Length",Oe=s=>new Promise((t,i)=>{const d=new FileReader;d.onload=()=>{const{result:n}=d;n instanceof ArrayBuffer?t(new Uint8Array(n)):t(new Uint8Array)},d.onerror=n=>{var m,x;i(Error(`File could not be read! Code=${((x=(m=n==null?void 0:n.target)==null?void 0:m.error)==null?void 0:x.code)||-1}`))},d.readAsArrayBuffer(s)}),ie=async s=>{let t;if(typeof s=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(s)?t=atob(s.split(",")[1]).split("").map(i=>i.charCodeAt(0)):t=await(await fetch(s)).arrayBuffer();else if(s instanceof URL)t=await(await fetch(s)).arrayBuffer();else if(s instanceof File||s instanceof Blob)t=await Oe(s);else return new Uint8Array;return new Uint8Array(t)},Se=async(s,t)=>{var n;const i=await fetch(s);let d;try{const m=parseInt(i.headers.get(Ae)||"-1"),x=(n=i.body)==null?void 0:n.getReader();if(!x)throw Fe;const E=[];let R=0;for(;;){const{done:b,value:P}=await x.read(),g=P?P.length:0;if(b){if(m!=-1&&m!==R)throw Re;t&&t({url:s,total:m,received:R,delta:g,done:b});break}E.push(P),R+=g,t&&t({url:s,total:m,received:R,delta:g,done:b})}const w=new Uint8Array(R);let f=0;for(const b of E)w.set(b,f),f+=b.length;d=w.buffer}catch(m){console.log("failed to send download progress event: ",m),d=await i.arrayBuffer()}return d},z=async(s,t,i=!1,d)=>{const n=i?await Se(s,d):await(await fetch(s)).arrayBuffer(),m=new Blob([n],{type:t});return URL.createObjectURL(m)},Te={class:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8"},Le={class:"grid grid-cols-1 lg:grid-cols-10 gap-8"},Ge={class:"lg:col-span-6 order-1 lg:order-2"},We={class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8"},_e={class:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md"},Be={class:"flex items-center"},He={class:"text-blue-800 dark:text-blue-200"},Ne={class:"mb-8"},Xe={class:"mt-4"},$e={key:0,class:"mt-2 text-sm text-blue-600 dark:text-blue-400"},Ue={key:1,class:"mt-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-md"},je={class:"grid grid-cols-2 gap-2 text-xs text-gray-600 dark:text-gray-400"},qe={class:"mb-8"},Ke={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ze={class:"text-center"},Qe=["disabled"],Je={key:0,class:"inline-block h-5 w-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ye={key:1,class:"inline-block h-5 w-5 mr-2 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ze={key:0,class:"mt-8"},ea={class:"flex items-center justify-between mb-2"},aa={class:"text-sm font-medium text-blue-600 dark:text-blue-400"},la={class:"bg-gray-200 dark:bg-gray-700 rounded-full h-2"},oa={key:1,class:"mt-8"},ta={class:"flex items-center justify-between mb-2"},ia={class:"text-sm font-medium text-blue-600 dark:text-blue-400"},sa={class:"bg-gray-200 dark:bg-gray-700 rounded-full h-2"},ra={key:2,class:"mt-8 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md"},Q="https://cdn.jsdelivr.net/npm/@ffmpeg/core-mt@0.12.10/dist/esm",ca=we({__name:"VideoConverter",setup(s){const t=V(!1),i=V(!1),d=V(!1),n=V(0),m=V(null),x=V(null),E=V(""),R=V("请选择视频文件开始转换"),w=V(null),f=V({duration:0,fps:30,resolution:"未知",bitrate:"未知",videoCodec:"未知",audioCodec:"未知"}),b=o=>{R.value=o,console.log(`[VideoConverter] ${o}`)},P=V("mp4"),g=V("high"),H=V("original"),N=V("original"),W={input:[{value:"mp4",label:"MP4 (H.264/H.265)",codecs:["h264","h265","hevc"]},{value:"avi",label:"AVI (Xvid/DivX)",codecs:["xvid","divx","h264"]},{value:"mov",label:"MOV (QuickTime)",codecs:["h264","h265","prores"]},{value:"mkv",label:"MKV (Matroska)",codecs:["h264","h265","vp8","vp9"]},{value:"wmv",label:"WMV (Windows Media)",codecs:["wmv1","wmv2","wmv3"]},{value:"flv",label:"FLV (Flash Video)",codecs:["h264","vp6"]},{value:"webm",label:"WebM (Web Video)",codecs:["vp8","vp9","av1"]},{value:"m4v",label:"M4V (iTunes)",codecs:["h264","h265"]},{value:"3gp",label:"3GP (Mobile)",codecs:["h264","h263"]},{value:"ogv",label:"OGV (Ogg Video)",codecs:["theora"]},{value:"ts",label:"TS (Transport Stream)",codecs:["h264","h265"]},{value:"mts",label:"MTS (AVCHD)",codecs:["h264"]},{value:"rm",label:"RM (RealMedia)",codecs:["rv40","rv50"]},{value:"rmvb",label:"RMVB (RealMedia)",codecs:["rv40","rv50"]},{value:"asf",label:"ASF (Advanced Systems)",codecs:["wmv1","wmv2"]},{value:"vob",label:"VOB (DVD Video)",codecs:["mpeg2","h264"]},{value:"mpg",label:"MPG (MPEG-1/2)",codecs:["mpeg1","mpeg2"]},{value:"mpeg",label:"MPEG (MPEG-1/2)",codecs:["mpeg1","mpeg2"]},{value:"divx",label:"DIVX (DivX)",codecs:["divx","h264"]},{value:"xvid",label:"XVID (Xvid)",codecs:["xvid"]},{value:"swf",label:"SWF (Flash)",codecs:["vp6","h264"]},{value:"f4v",label:"F4V (Flash Video)",codecs:["h264"]},{value:"m2ts",label:"M2TS (Blu-ray)",codecs:["h264","h265"]},{value:"mxf",label:"MXF (Material Exchange)",codecs:["h264","h265","prores"]},{value:"gif",label:"GIF (Animated)",codecs:["gif"]},{value:"apng",label:"APNG (Animated PNG)",codecs:["apng"]},{value:"bmp",label:"BMP (Bitmap)",codecs:["bmp"]},{value:"png",label:"PNG (Portable Network)",codecs:["png"]},{value:"jpg",label:"JPEG (Joint Photographic)",codecs:["mjpeg"]},{value:"jpeg",label:"JPEG (Joint Photographic)",codecs:["mjpeg"]},{value:"tiff",label:"TIFF (Tagged Image)",codecs:["tiff"]},{value:"tga",label:"TGA (Targa)",codecs:["tga"]},{value:"ico",label:"ICO (Icon)",codecs:["ico"]},{value:"pcx",label:"PCX (PC Paintbrush)",codecs:["pcx"]},{value:"ppm",label:"PPM (Portable Pixmap)",codecs:["ppm"]},{value:"pgm",label:"PGM (Portable Graymap)",codecs:["pgm"]},{value:"pbm",label:"PBM (Portable Bitmap)",codecs:["pbm"]},{value:"sgi",label:"SGI (Silicon Graphics)",codecs:["sgi"]},{value:"cin",label:"CIN (Cineon)",codecs:["cin"]},{value:"dpx",label:"DPX (Digital Picture)",codecs:["dpx"]},{value:"exr",label:"EXR (OpenEXR)",codecs:["exr"]},{value:"hdr",label:"HDR (High Dynamic Range)",codecs:["hdr"]},{value:"webp",label:"WebP (Web Picture)",codecs:["webp"]},{value:"avif",label:"AVIF (AV1 Image)",codecs:["av1"]},{value:"heic",label:"HEIC (HEIF)",codecs:["hevc"]},{value:"heif",label:"HEIF (High Efficiency)",codecs:["hevc"]}],output:[{value:"mp4",label:"MP4 (H.264/H.265)",videoCodec:"libx264",audioCodec:"aac"},{value:"avi",label:"AVI (Xvid)",videoCodec:"libxvid",audioCodec:"mp3"},{value:"mov",label:"MOV (QuickTime)",videoCodec:"libx264",audioCodec:"aac"},{value:"mkv",label:"MKV (Matroska)",videoCodec:"libx264",audioCodec:"aac"},{value:"wmv",label:"WMV (Windows Media)",videoCodec:"wmv2",audioCodec:"wmav2"},{value:"flv",label:"FLV (Flash Video)",videoCodec:"libx264",audioCodec:"mp3"},{value:"webm",label:"WebM (Web Video)",videoCodec:"libvpx",audioCodec:"libvorbis"},{value:"m4v",label:"M4V (iTunes)",videoCodec:"libx264",audioCodec:"aac"},{value:"3gp",label:"3GP (Mobile)",videoCodec:"libx264",audioCodec:"aac"},{value:"ogv",label:"OGV (Ogg Video)",videoCodec:"libtheora",audioCodec:"libvorbis"},{value:"ts",label:"TS (Transport Stream)",videoCodec:"libx264",audioCodec:"aac"},{value:"mts",label:"MTS (AVCHD)",videoCodec:"libx264",audioCodec:"aac"},{value:"asf",label:"ASF (Advanced Systems)",videoCodec:"wmv2",audioCodec:"wmav2"},{value:"vob",label:"VOB (DVD Video)",videoCodec:"mpeg2video",audioCodec:"mp2"},{value:"mpg",label:"MPG (MPEG-1/2)",videoCodec:"mpeg2video",audioCodec:"mp2"},{value:"mpeg",label:"MPEG (MPEG-1/2)",videoCodec:"mpeg2video",audioCodec:"mp2"},{value:"divx",label:"DIVX (DivX)",videoCodec:"libxvid",audioCodec:"mp3"},{value:"xvid",label:"XVID (Xvid)",videoCodec:"libxvid",audioCodec:"mp3"},{value:"swf",label:"SWF (Flash)",videoCodec:"flv",audioCodec:"mp3"},{value:"f4v",label:"F4V (Flash Video)",videoCodec:"libx264",audioCodec:"aac"},{value:"m2ts",label:"M2TS (Blu-ray)",videoCodec:"libx264",audioCodec:"aac"},{value:"mxf",label:"MXF (Material Exchange)",videoCodec:"libx264",audioCodec:"aac"},{value:"gif",label:"GIF (Animated)",videoCodec:"gif",audioCodec:null},{value:"apng",label:"APNG (Animated PNG)",videoCodec:"apng",audioCodec:null},{value:"webp",label:"WebP (Web Picture)",videoCodec:"libwebp",audioCodec:null},{value:"avif",label:"AVIF (AV1 Image)",videoCodec:"libaom-av1",audioCodec:null},{value:"heic",label:"HEIC (HEIF)",videoCodec:"libx265",audioCodec:null},{value:"heif",label:"HEIF (High Efficiency)",videoCodec:"libx265",audioCodec:null}]},y=new De;ye(async()=>{y.off("log",()=>{}),y.off("progress",()=>{}),y.on("log",({message:o})=>{var a;if(i.value){if(o.includes("frame=")&&o.includes("fps=")||o.includes("size=")&&o.includes("bitrate="))return;(o.includes("Stream mapping:")||o.includes("Output #")||o.includes("video:")||o.includes("audio:")||o.includes("muxing overhead:"))&&console.log(`[FFmpeg] ${o}`)}else(o.includes("Duration:")||o.includes("Video:")||o.includes("Audio:"))&&console.log(`[FFmpeg] ${o}`);if(o.includes("Duration:")){const l=o.match(/Duration: (\d{2}):(\d{2}):(\d{2}\.\d{2})/);if(l){const u=parseInt(l[1]),r=parseInt(l[2]),h=parseFloat(l[3]),v=u*3600+r*60+h;f.value||(f.value={duration:0,fps:30,resolution:"未知",bitrate:"未知",videoCodec:"未知",audioCodec:"未知"}),f.value.duration=v}}if(o.includes("Video:")){const l=o.match(/(\d{3,4})x(\d{3,4})/),u=o.match(/(\d+) fps/),r=o.match(/Video: (\w+)/),h=o.match(/(\d+) kb\/s/);if(f.value||(f.value={duration:0,fps:30,resolution:"未知",bitrate:"未知",videoCodec:"未知",audioCodec:"未知"}),l){const v=parseInt(l[1]),D=parseInt(l[2]);v>=100&&D>=100&&(f.value.resolution=`${v}x${D}`)}u&&(f.value.fps=parseInt(u[1])),r&&(f.value.videoCodec=r[1]),h&&(f.value.bitrate=`${h[1]} kb/s`)}if(o.includes("Audio:")){const l=o.match(/Audio: (\w+)/);f.value||(f.value={duration:0,fps:30,resolution:"未知",bitrate:"未知",videoCodec:"未知",audioCodec:"未知"}),l&&(f.value.audioCodec=l[1])}if(o.includes("frame=")){const l=o.match(/frame=\s*(\d+)/);if(l&&i.value){const u=parseInt(l[1]),r=((a=w.value)==null?void 0:a.totalFrames)||111,h=Math.min(u/r*.4,.4);n.value=h*100}}}),y.on("progress",({progress:o})=>{});try{d.value=!0,b("正在加载资源...");const o=setInterval(()=>{n.value<80&&(n.value+=5,b(`正在加载资源... ${n.value}%`))},200);await y.load({coreURL:await z(`${Q}/ffmpeg-core.js`,"text/javascript"),wasmURL:await z(`${Q}/ffmpeg-core.wasm`,"application/wasm"),workerURL:await z(`${Q}/ffmpeg-core.worker.js`,"text/javascript")}),clearInterval(o),n.value=100,b("资源加载完成！"),t.value=!0,d.value=!1,await new Promise(a=>setTimeout(a,1e3)),b("请选择视频文件开始转换"),n.value=0}catch(o){console.error("FFmpeg加载失败:",o),b("资源加载失败，请刷新页面重试"),d.value=!1}});const se=async o=>{const a=o.target;a.files&&a.files[0]&&(m.value=a.files[0],x.value=null,E.value="",n.value=0,w.value=null,b(`已选择文件: ${m.value.name}`),await J())},re=async o=>{var a;console.log(o),o.preventDefault(),(a=o.dataTransfer)!=null&&a.files&&o.dataTransfer.files[0]&&(m.value=o.dataTransfer.files[0],x.value=null,E.value="",n.value=0,w.value=null,b(`已选择文件: ${m.value.name}`),await J())},ne=o=>{o.preventDefault()},J=async()=>{if(m.value){if(!t.value){b("资源尚未加载完成，无法读取视频信息");return}try{b("正在读取视频信息..."),f.value={duration:0,fps:30,resolution:"未知",bitrate:"未知",videoCodec:"未知",audioCodec:"未知"};const o=Y(m.value.name);await y.writeFile(`temp_input.${o}`,await ie(m.value)),console.log("尝试使用exec获取视频信息...");try{if(await y.exec(["-i",`temp_input.${o}`]),f.value&&f.value.duration>0){const a=Math.round(f.value.duration*f.value.fps);w.value={duration:f.value.duration,fps:f.value.fps,totalFrames:a,resolution:f.value.resolution,bitrate:f.value.bitrate,format:o},b(`视频信息读取成功: ${f.value.resolution}, ${f.value.duration.toFixed(2)}秒, ${f.value.fps}fps`),console.log("解析到的视频信息:",f.value)}else throw new Error("无法解析视频信息")}catch(a){throw console.error("exec命令失败:",a),new Error("无法读取视频信息")}await y.deleteFile(`temp_input.${o}`)}catch(o){console.error("读取视频信息失败:",o),b("读取视频信息失败，无法继续转换"),w.value=null,m.value=null}}},de=async()=>{if(!m.value||!y){alert("请先选择视频文件");return}const o=Y(m.value.name),a=P.value;console.log("开始转换:",m.value.name,"→",P.value),i.value=!0,n.value=0,b("正在加载资源...");try{if(!t.value){b("资源尚未加载完成，请稍候...");return}b("开始转换..."),n.value=0,b("正在写入输入文件..."),await y.writeFile(`input.${o}`,await ie(m.value)),n.value=0,await ue(o,a),b("正在读取输出文件...");try{const l=await y.readFile(`output.${a}`);if(!l||l.length===0)throw new Error("输出文件为空或无效");x.value=new Blob([l],{type:`video/${a}`}),E.value=URL.createObjectURL(x.value),n.value=100,b("转换完成！"),console.log("转换成功，文件大小:",l.length,"字节"),await q(o,a)}catch(l){console.error("读取输出文件失败:",l);try{const u=await y.readFile(`video_only.${a}`);if(u&&u.length>0){x.value=new Blob([u],{type:`video/${a}`}),E.value=URL.createObjectURL(x.value),n.value=100,b("转换完成！（仅视频）"),console.log("转换成功（仅视频），文件大小:",u.length,"字节"),await q(o,a);return}}catch(u){console.error("视频文件也不存在:",u)}throw new Error(`读取输出文件失败: ${l.message||l.toString()}`)}}catch(l){console.error("转换失败:",l.message||l.toString());let u="转换失败，请检查文件格式或重试";const r=l.message||l.toString()||"";r.includes("超时")?u="转换超时，建议：1. 尝试更小的文件 2. 降低视频质量设置 3. 检查网络连接":r.includes("编码器")?u="编码器错误，建议：1. 尝试不同的输出格式 2. 检查输入文件是否损坏":r.includes("内存")?u="内存不足，建议：1. 关闭其他程序 2. 尝试更小的文件":r.includes("stream")||r.includes("map")?u="流映射错误，建议：1. 尝试选择'仅视频'选项 2. 检查音频流是否兼容 3. 尝试不同的输出格式":(r.includes("音频")||r.includes("audio"))&&(u="音频处理错误，建议：1. 选择'仅视频'选项 2. 尝试不同的音频处理模式 3. 检查音频编码器兼容性"),b(u),alert(u),await q(o,a)}finally{i.value=!1,d.value=!1}},ue=async(o,a)=>{let l=0,u=0,r=0;const h=new Promise((v,D)=>{setTimeout(()=>{D(new Error("转换超时，请尝试更小的文件或更低的设置"))},1e3*60)});try{const v=W.output.find(X=>X.value===a),D=!(v!=null&&v.audioCodec);b("正在转码视频..."),n.value=0;const fe=ce(o,a),ge=Date.now();if(await Promise.race([y.exec(fe),h]),l=Date.now()-ge,n.value=D?100:40,!D){b("正在处理音频..."),n.value=40;const X=ve(o,a);if(X){const K=Date.now();await Promise.race([y.exec(X),h]),u=Date.now()-K}n.value=80,b("正在合并视频和音频..."),n.value=80;const Z=me(a);if(Z){const K=Date.now();await Promise.race([y.exec(Z),h]),r=Date.now()-K}n.value=100}console.log("转码完成，总耗时:",l+u+r,"ms")}catch(v){throw console.error("转码失败:",v),v}},ce=(o,a)=>{const l=["-i",`input.${o}`];if(H.value!=="original"){const v={"4k":"3840:2160","1080p":"1920:1080","720p":"1280:720","480p":"854:480"};l.push("-vf",`scale=${v[H.value]}`)}N.value!=="original"&&l.push("-r",N.value);const u=W.output.find(v=>v.value===a),r=(u==null?void 0:u.videoCodec)||"libx264",h=g.value==="high"?18:g.value==="medium"?23:28;if(r==="libx264"||r==="libx265")l.push("-c:v",r,"-preset","ultrafast","-crf",h.toString());else if(r==="libvpx"){const v=g.value==="high"?"good":(g.value==="medium","realtime");l.push("-c:v",r,"-quality",v,"-crf",h.toString())}else if(r==="libtheora"){const v=g.value==="high"?"8":g.value==="medium"?"6":"4";l.push("-c:v",r,"-q:v",v)}else if(r==="wmv2"){const v=g.value==="high"?"2000k":g.value==="medium"?"1000k":"500k";l.push("-c:v",r,"-b:v",v)}else if(r==="mpeg2video"){const v=g.value==="high"?"4000k":g.value==="medium"?"2000k":"1000k";l.push("-c:v",r,"-b:v",v)}else if(r==="libxvid"){const v=g.value==="high"?"3":g.value==="medium"?"5":"7";l.push("-c:v",r,"-qscale:v",v)}else if(r==="gif"||r==="apng")l.push("-c:v",r);else if(r==="libwebp"){const v=g.value==="high"?"90":g.value==="medium"?"70":"50";l.push("-c:v",r,"-quality",v)}else if(r==="libaom-av1"){const v=g.value==="high"?"20":g.value==="medium"?"30":"40";l.push("-c:v",r,"-crf",v)}else l.push("-c:v","libx264","-preset","ultrafast","-crf",h.toString());return r!=="gif"&&r!=="apng"&&r!=="libwebp"&&r!=="libaom-av1"&&l.push("-an"),l.push("-y",`video_only.${a}`),l},ve=(o,a)=>{const l=["-i",`input.${o}`];l.push("-vn");const u=W.output.find(h=>h.value===a),r=u==null?void 0:u.audioCodec;return r?(r==="mp3"?(l.push("-c:a","mp3","-b:a","128k","-ar","44100"),l.push("-y","audio.mp3")):r==="aac"?(l.push("-c:a","aac","-b:a","128k","-ar","48000"),l.push("-y","audio.aac")):r==="libvorbis"?(l.push("-c:a","libvorbis","-b:a","128k","-ar","48000"),l.push("-y","audio.ogg")):r==="wmav2"?(l.push("-c:a","wmav2","-b:a","128k","-ar","44100"),l.push("-y","audio.wma")):r==="mp2"?(l.push("-c:a","mp2","-b:a","192k","-ar","48000"),l.push("-y","audio.mp2")):(l.push("-c:a","aac","-b:a","128k","-ar","48000"),l.push("-y","audio.aac")),l):null},me=o=>{const a=W.output.find(h=>h.value===o),l=a==null?void 0:a.audioCodec;if(!l)return null;let u="audio.aac";return l==="mp3"?u="audio.mp3":l==="libvorbis"?u="audio.ogg":l==="wmav2"?u="audio.wma":l==="mp2"&&(u="audio.mp2"),["-i",`video_only.${o}`,"-i",u,"-c:v","copy","-c:a","copy","-shortest","-y",`output.${o}`]},q=async(o,a)=>{try{const l=W.output.find(v=>v.value===a),u=l==null?void 0:l.audioCodec;let r="audio.aac";u==="mp3"?r="audio.mp3":u==="libvorbis"?r="audio.ogg":u==="wmav2"?r="audio.wma":u==="mp2"&&(r="audio.mp2");const h=[`input.${o}`,`video_only.${a}`,r,`output.${a}`];for(const v of h)try{await y.deleteFile(v)}catch(D){console.warn("删除临时文件失败:",D)}}catch(l){console.warn("清理临时文件失败:",l)}},Y=o=>{var a;return((a=o.split(".").pop())==null?void 0:a.toLowerCase())||"mp4"},be=async()=>{try{const o=await fetch("/api/tools/record-usage-public",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({tool_name:"视频转码"})});o.ok?console.log("工具使用记录已保存"):console.warn("工具使用记录失败:",o.status)}catch(o){console.warn("记录工具使用时出错:",o)}},pe=async()=>{if(x.value&&E.value&&m.value){const o=document.createElement("a");o.href=E.value;const a=m.value.name,l=a.substring(0,a.lastIndexOf("."));o.download=`${l}.${P.value}`,document.body.appendChild(o),o.click(),document.body.removeChild(o),await be()}};return(o,a)=>(O(),Ee(Ve,{title:"视频格式转换工具 - 在线MP4、AVI、MOV、MKV转换器 | 小左子的工具箱"},{default:ke(()=>[e("div",Te,[e("div",Le,[a[27]||(a[27]=e("div",{class:"lg:col-span-4 order-2 lg:order-1"},[e("div",{class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 lg:sticky lg:top-8"},[e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-4"}," 在线视频格式转换工具 "),e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-4"}," 专业的在线视频格式转换器，支持MP4、AVI、MOV、MKV等多种格式转换。无需下载软件，免费在线使用，快速高效。 "),e("div",{class:"grid grid-cols-2 gap-4"},[e("div",null,[e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"}," 支持的输入格式 "),e("ul",{class:"text-gray-600 dark:text-gray-400 space-y-1 text-sm"},[e("li",null,"• MP4 (H.264, H.265)"),e("li",null,"• AVI (Xvid, DivX)"),e("li",null,"• MOV (QuickTime)"),e("li",null,"• MKV (Matroska)"),e("li",null,"• WMV (Windows Media)"),e("li",null,"• FLV (Flash Video)"),e("li",null,"• WebM (VP8, VP9, AV1)"),e("li",null,"• M4V (iTunes)"),e("li",null,"• 3GP (Mobile)"),e("li",null,"• OGV (Ogg Video)"),e("li",null,"• TS/MTS (Transport Stream)"),e("li",null,"• RM/RMVB (RealMedia)"),e("li",null,"• ASF (Advanced Systems)"),e("li",null,"• VOB (DVD Video)"),e("li",null,"• MPG/MPEG (MPEG-1/2)"),e("li",null,"• SWF/F4V (Flash)"),e("li",null,"• M2TS (Blu-ray)"),e("li",null,"• MXF (Material Exchange)"),e("li",null,"• GIF/APNG (Animated)"),e("li",null,"• WebP/AVIF (Web Images)"),e("li",null,"• HEIC/HEIF (High Efficiency)"),e("li",null,"• 以及更多图片格式...")])]),e("div",null,[e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"}," 支持的输出格式 "),e("ul",{class:"text-gray-600 dark:text-gray-400 space-y-1 text-sm"},[e("li",null,"• MP4 (H.264, H.265)"),e("li",null,"• AVI (Xvid)"),e("li",null,"• MOV (QuickTime)"),e("li",null,"• MKV (Matroska)"),e("li",null,"• WMV (Windows Media)"),e("li",null,"• FLV (Flash Video)"),e("li",null,"• WebM (VP8, VP9, AV1)"),e("li",null,"• M4V (iTunes)"),e("li",null,"• 3GP (Mobile)"),e("li",null,"• OGV (Ogg Video)"),e("li",null,"• TS/MTS (Transport Stream)"),e("li",null,"• ASF (Advanced Systems)"),e("li",null,"• VOB (DVD Video)"),e("li",null,"• MPG/MPEG (MPEG-1/2)"),e("li",null,"• SWF/F4V (Flash)"),e("li",null,"• M2TS (Blu-ray)"),e("li",null,"• MXF (Material Exchange)"),e("li",null,"• GIF/APNG (Animated)"),e("li",null,"• WebP/AVIF (Web Images)"),e("li",null,"• HEIC/HEIF (High Efficiency)"),e("li",null,"• 以及更多图片格式...")])])]),e("div",{class:"mt-6 space-y-4"},[e("div",{class:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md"},[e("div",{class:"flex items-start"},[e("svg",{class:"h-5 w-5 text-green-400 mr-2 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("div",null,[e("h4",{class:"text-sm font-medium text-green-800 dark:text-green-200"}," 智能分离转码 "),e("p",{class:"text-sm text-green-700 dark:text-green-300 mt-1"}," 系统采用分离式转码技术，分别处理视频和音频，有效避免转换卡住问题，提供更稳定的转换体验。 "),e("div",{class:"mt-2 text-xs text-green-600 dark:text-green-400"},[e("div",null,"• 自动检测音频流并选择最佳处理方式"),e("div",null,"• 视频和音频独立处理，避免相互影响"),e("div",null,"• 支持多种音频编码器，兼容性更好")])])])]),e("div",{class:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md"},[e("div",{class:"flex items-start"},[e("svg",{class:"h-5 w-5 text-blue-400 mr-2 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})]),e("div",null,[e("h4",{class:"text-sm font-medium text-blue-800 dark:text-blue-200"}," 强大的格式转换支持 "),e("p",{class:"text-sm text-blue-700 dark:text-blue-300 mt-1"}," 基于融茂软件核心，支持超过50种视频格式和编码器，包括最新的AV1、H.265等先进编码技术。 "),e("div",{class:"mt-2 text-xs text-blue-600 dark:text-blue-400"},[e("div",null,"• 支持H.264、H.265、VP8、VP9、AV1等现代编码"),e("div",null,"• 兼容MPEG-1/2、Xvid、DivX等传统格式"),e("div",null,"• 支持GIF、WebP、AVIF等图片和动画格式"),e("div",null,"• 专业级MXF、M2TS等广播级格式支持")])])])])])])],-1)),e("div",Ge,[e("div",We,[e("div",_e,[e("div",Be,[a[4]||(a[4]=e("svg",{class:"h-5 w-5 text-blue-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",He,I(R.value),1)])]),e("div",Ne,[a[9]||(a[9]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-4"}," 选择视频文件 ",-1)),e("div",{onDrop:re,onDragover:ne,class:Me(["border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-blue-400 dark:hover:border-blue-400 transition-colors",{"border-blue-400 bg-blue-50 dark:bg-blue-900/20":m.value}])},[a[8]||(a[8]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48"},[e("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),e("div",Xe,[a[6]||(a[6]=e("label",{for:"file-upload",class:"cursor-pointer bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors"}," 选择文件 ",-1)),e("input",{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",accept:"video/*",onChange:se},null,32),a[7]||(a[7]=e("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"}," 支持 MP4, AVI, MOV, MKV, WMV, WebM, M4V, 3GP, OGV, TS, MTS, RM, RMVB, ASF, VOB, MPG, MPEG, DIVX, XVID, SWF, F4V, M2TS, MXF, GIF, APNG, WebP, AVIF, HEIC, HEIF 等格式 ",-1)),m.value?(O(),T("p",$e," 已选择: "+I(m.value.name),1)):B("",!0),w.value?(O(),T("div",Ue,[a[5]||(a[5]=e("h4",{class:"text-sm font-medium text-gray-900 dark:text-white mb-2"}," 视频信息 ",-1)),e("div",je,[e("div",null,"时长: "+I(w.value.duration.toFixed(2))+"秒",1),e("div",null,"帧率: "+I(w.value.fps.toFixed(2))+"fps",1),e("div",null,"总帧数: "+I(w.value.totalFrames),1),e("div",null,"分辨率: "+I(w.value.resolution),1),e("div",null,"比特率: "+I(w.value.bitrate),1),e("div",null,"格式: "+I(w.value.format),1)])])):B("",!0)])],34)]),e("div",qe,[a[18]||(a[18]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-4"}," 转换选项 ",-1)),e("div",Ke,[e("div",null,[a[11]||(a[11]=e("label",{for:"output-format",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 输出格式 ",-1)),$(e("select",{id:"output-format","onUpdate:modelValue":a[0]||(a[0]=l=>P.value=l),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},a[10]||(a[10]=[e("option",{value:"mp4"},"MP4 (H.264/H.265)",-1),e("option",{value:"avi"},"AVI (Xvid)",-1),e("option",{value:"mov"},"MOV (QuickTime)",-1),e("option",{value:"mkv"},"MKV (Matroska)",-1),e("option",{value:"wmv"},"WMV (Windows Media)",-1),e("option",{value:"flv"},"FLV (Flash Video)",-1),e("option",{value:"webm"},"WebM (VP8/VP9/AV1)",-1),e("option",{value:"m4v"},"M4V (iTunes)",-1),e("option",{value:"3gp"},"3GP (Mobile)",-1),e("option",{value:"ogv"},"OGV (Ogg Video)",-1),e("option",{value:"ts"},"TS (Transport Stream)",-1),e("option",{value:"mts"},"MTS (AVCHD)",-1),e("option",{value:"asf"},"ASF (Advanced Systems)",-1),e("option",{value:"vob"},"VOB (DVD Video)",-1),e("option",{value:"mpg"},"MPG (MPEG-1/2)",-1),e("option",{value:"mpeg"},"MPEG (MPEG-1/2)",-1),e("option",{value:"divx"},"DIVX (DivX)",-1),e("option",{value:"xvid"},"XVID (Xvid)",-1),e("option",{value:"swf"},"SWF (Flash)",-1),e("option",{value:"f4v"},"F4V (Flash Video)",-1),e("option",{value:"m2ts"},"M2TS (Blu-ray)",-1),e("option",{value:"mxf"},"MXF (Material Exchange)",-1),e("option",{value:"gif"},"GIF (Animated)",-1),e("option",{value:"apng"},"APNG (Animated PNG)",-1),e("option",{value:"webp"},"WebP (Web Picture)",-1),e("option",{value:"avif"},"AVIF (AV1 Image)",-1),e("option",{value:"heic"},"HEIC (HEIF)",-1),e("option",{value:"heif"},"HEIF (High Efficiency)",-1)]),512),[[U,P.value]])]),e("div",null,[a[13]||(a[13]=e("label",{for:"video-quality",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 视频质量 ",-1)),$(e("select",{id:"video-quality","onUpdate:modelValue":a[1]||(a[1]=l=>g.value=l),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},a[12]||(a[12]=[e("option",{value:"high"},"高质量",-1),e("option",{value:"medium"},"中等质量",-1),e("option",{value:"low"},"低质量",-1)]),512),[[U,g.value]])]),e("div",null,[a[15]||(a[15]=e("label",{for:"resolution",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 分辨率 ",-1)),$(e("select",{id:"resolution","onUpdate:modelValue":a[2]||(a[2]=l=>H.value=l),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},a[14]||(a[14]=[e("option",{value:"original"},"保持原分辨率",-1),e("option",{value:"4k"},"4K (3840x2160)",-1),e("option",{value:"1080p"},"1080p (1920x1080)",-1),e("option",{value:"720p"},"720p (1280x720)",-1),e("option",{value:"480p"},"480p (854x480)",-1)]),512),[[U,H.value]])]),e("div",null,[a[17]||(a[17]=e("label",{for:"framerate",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 帧率 ",-1)),$(e("select",{id:"framerate","onUpdate:modelValue":a[3]||(a[3]=l=>N.value=l),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},a[16]||(a[16]=[e("option",{value:"original"},"保持原帧率",-1),e("option",{value:"60"},"60 FPS",-1),e("option",{value:"30"},"30 FPS",-1),e("option",{value:"25"},"25 FPS",-1),e("option",{value:"24"},"24 FPS",-1)]),512),[[U,N.value]])])])]),e("div",ze,[e("button",{onClick:de,disabled:!m.value||!w.value||i.value||!t.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium py-3 px-8 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[i.value?(O(),T("svg",Ye,a[20]||(a[20]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)]))):(O(),T("svg",Je,a[19]||(a[19]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"},null,-1)]))),le(" "+I(i.value?"转换中...":"开始转换"),1)],8,Qe)]),d.value?(O(),T("div",Ze,[a[22]||(a[22]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"}," 资源加载进度 ",-1)),e("div",ea,[a[21]||(a[21]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"正在加载核心文件，请稍候...",-1)),e("span",aa,I(Math.round(n.value))+"%",1)]),e("div",la,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:oe({width:n.value+"%"})},null,4)])])):B("",!0),i.value&&!d.value?(O(),T("div",oa,[a[24]||(a[24]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"}," 转换进度 ",-1)),e("div",ta,[a[23]||(a[23]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"正在转换中，请稍候...",-1)),e("span",ia,I(Math.round(n.value))+"%",1)]),e("div",sa,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:oe({width:n.value+"%"})},null,4)])])):B("",!0),x.value&&E.value?(O(),T("div",ra,[e("div",{class:"flex items-center justify-between"},[a[26]||(a[26]=e("div",{class:"flex items-center"},[e("svg",{class:"h-5 w-5 text-green-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",{class:"text-green-800 dark:text-green-200"},"转换完成！")],-1)),e("button",{onClick:pe,class:"bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition-colors"},a[25]||(a[25]=[e("svg",{class:"inline-block h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),le(" 下载文件 ",-1)]))])])):B("",!0)])])])])]),_:1}))}});export{ca as default};
